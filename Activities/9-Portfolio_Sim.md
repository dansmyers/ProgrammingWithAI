# Monte Carlo Portfolio Simulation

## Setup

Open your Codespace. Start by making a new directory to hold files for this unit. Type the following command in the terminal:
```
mkdir 3-Simulation
```
Then `cd` into it:
```
cd 3-Simulation
```
You should see your terminal prompt update to indicate that you're now working in the `3-Simulation` folder.

Next, install the `yfinance` Python module that we'll use to fetch stock market data:
```
pip install yfinance
```

## Example: Plotting a stock price with `yfinance`

The `yfinance` library has the ability to pull data from Yahoo Finance for specified stock tickers over a given range of dates. The example below shows how to get the price  of a specific stock over the past year and plot it.

Start by creating a new file. In the terminal, type:
```
touch price_chart.py
```
Open the file, then copy the code below into it.
```
"""
Stock Price Plotter
Fetches stock price data for the last year and creates a plot
"""

import yfinance as yf
import matplotlib.pyplot as plt
import pandas as pd
from datetime import datetime, timedelta

# Define the ticker symbol
ticker = "BTC-USD"

# Calculate date range (last year)
end_date = datetime.now()
start_date = end_date - timedelta(days=365)

# Download stock data
print(f"Fetching {ticker} stock data from {start_date.date()} to {end_date.date()}...")
stock_data = yf.download(ticker, start=start_date, end=end_date, progress=False)

# Handle multi-index columns (yfinance sometimes returns these)
if isinstance(stock_data.columns, pd.MultiIndex):
    stock_data.columns = stock_data.columns.droplevel(1)

# Check if data was retrieved
if stock_data.empty:
    print("Error: No data retrieved. Please check your internet connection and ticker symbol.")
    exit(1)

# Create the plot
plt.figure(figsize=(12, 6))
plt.plot(stock_data.index, stock_data['Close'], linewidth=2, color='#E82127')
plt.title(f'{ticker} Stock Price - Last Year', fontsize=16, fontweight='bold')
plt.xlabel('Date', fontsize=12)
plt.ylabel('Price (USD)', fontsize=12)
plt.grid(True, alpha=0.3)
plt.tight_layout()

# Save the plot
output_file = 'price_chart.png'
plt.savefig(output_file, dpi=300, bbox_inches='tight')
print(f"Chart saved as '{output_file}'")

# Display the plot
plt.show()

# Print some basic statistics
print(f"\n{ticker} Stock Statistics (Last Year):")
print(f"Starting Price: ${stock_data['Close'].iloc[0]:.2f}")
print(f"Ending Price: ${stock_data['Close'].iloc[-1]:.2f}")
print(f"Highest Price: ${stock_data['Close'].max():.2f}")
print(f"Lowest Price: ${stock_data['Close'].min():.2f}")
print(f"Average Price: ${stock_data['Close'].mean():.2f}")
```

Take a moment to look at the code. The top line imports the `yfinance` module and gives it the name `yf` for use in the rest of the program:
```
import yfinance as yf
```
The line
```
stock_data = yf.download(ticker, start=start_date, end=end_date, progress=False)
```
Fetches the data, using the string assigned `ticker` a few lines earlier:
```
# Define the ticker symbol
ticker = "TSLA"
```

Run the program:
```
python3 price_chart.py
```
This will produce a chart that as a .png file.

Experiment with plotting some other charts by changing `ticker`:

- Other stocks: `'AAPL'`, `'MSFT'`
- The entire S&P 500 index: `'^GSPC'` (notice the carat symbol at the beginning of the name)
- Bitcoin: `'BTC-USD'`

## Monte Carlo simulation

**Monte Carlo simulation** is a standard technique in financial analysis. Suppose you have a portfolio and you'd like to predict how it might perform in the future. You could try to come up with a mathematical model for market returns, but another option is to *use past data to simulate performance*.

Suppose that you have a simple index fund that's invested in the entire S&P 500 and you want to predict how it might perform over the next decade.

- First, gather the data of the historical returns generated by the S&P 500 over a representative period

- Take a *sample* of those returns, representing one potential path for how the market might perform over the next decade
  
- Repeat this process many times: each sample gives you a potential trajectory of the market. Some samples will have mostly positive returns, some will have multiple catastrophic drops, but the overall collection will represent a range of *likely* outcomes for the portfolio.

- Calculate statistics from the sampled outcomes, showing the mean and median expected returns across all simulated trials, plus other statistics of interest

### Example: 401k modeling

Start `claude`. Enter plan mode by typing `/plan` at the prompt.

Type the following prompt:
> I want to conduct a Monte Carlo simulation of a simple 401k investment. Suppose that a 25 year old begins investing $500 per month into an S&P 500 index fund, retiring at age 65. Use Monte Carlo simulation to generate a distribution of returns that this strategy might generate. Pull historical month-to-month returns for the S&P 500 using the yfinance module. Output a histogram of returns as a .png file.
Answer the plan questions, then generate the file.

Run the program and look at the results. What do you observe?

### Comparison

What happens if the investor uses the same strategy but doesn't start until age 35? Ask Claude to update the simulation to compare the two cases of starting at 25 vs. 35, keeping the other parameters the same. Ask it to output side-by-side box plots to show the different distributions generated by the two different scenarios.
